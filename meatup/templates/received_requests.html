{% extends 'base.html' %}

{% block content %}
<h1 class="text-2xl mb-4">Received Meatup Requests</h1>

<ul id="received-requests" class="mt-4">
    {% for req in requests %}
    <li id="req-{{ req.id }}" class="p-4 bg-gray-100 rounded mb-2">
        {{ req.sender.username }} requested a meetup for "{{ req.wishlist.item }}".

        <div class="flex mt-2 space-x-4">
            <select onchange="updateStatus({{ req.id }}, this.value)">
                <option value="pending" {% if req.status == 'pending' %}selected{% endif %}>Pending</option>
                <option value="agreed" {% if req.status == 'agreed' %}selected{% endif %}>Agreed</option>
                <option value="declined" {% if req.status == 'declined' %}selected{% endif %}>Declined</option>
            </select>
            <button onclick="deleteRequest({{ req.id }})" class="text-red-500">Delete</button>
        </div>
    </li>
    {% endfor %}
</ul>

<script>
async function updateStatus(requestId, newStatus) {
    const response = await fetch(`/meatup/requests/update/${requestId}/`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': '{{ csrf_token }}',
        },
        body: JSON.stringify({ status: newStatus }),
    });

    if (response.ok) {
        const data = await response.json();
        alert(data.message);
    } else {
        alert('Failed to update status.');
    }
}

async function deleteRequest(requestId) {
    const response = await fetch(`/meatup/requests/delete/${requestId}/`, {
        method: 'POST',
        headers: { 'X-CSRFToken': '{{ csrf_token }}' },
    });

    if (response.ok) {
        document.getElementById(`req-${requestId}`).remove();
        alert('Request deleted successfully!');
    } else {
        alert('Failed to delete request.');
    }
}
</script>
{% endblock content %}