<!-- {% extends 'base.html' %}

{% block content %}
<h1 class="text-2xl mb-4">Meatup Requests</h1>

<ul id="request-list" class="mt-4">
    {% for req in requests %}
    <li id="req-{{ req.id }}" class="p-4 bg-gray-100 rounded mb-2">
        {{ req.requested_at|date:"d/m/Y" }} - {{ req.sender.username }} requested a meetup with you

        <div class="flex mt-2 space-x-4">
            {% if req.status == 'pending' %}
            <button onclick="handleRequest({{ req.id }}, 'agree')" class="text-green-500">Agree</button>
            <button onclick="handleRequest({{ req.id }}, 'decline')" class="text-red-500">Decline</button>
            {% endif %}
            <a href="{% url 'meatup:edit_request' req.id %}" class="text-blue-500">Edit</a>
            <button onclick="deleteRequest({{ req.id }})" class="text-gray-500">Delete</button>
        </div>
        <p class="mt-2"><strong>Note:</strong> {{ req.note }}</p>
    </li>
    {% endfor %}
</ul>

<script>
async function handleRequest(requestId, action) {
    const response = await fetch(`/meatup/handle/${requestId}/${action}/`, {
        method: 'POST',
        headers: { 'X-CSRFToken': '{{ csrf_token }}' },
    });

    if (response.ok) {
        document.getElementById(`req-${requestId}`).remove();
        alert('Request handled successfully!');
    } else {
        alert('Failed to handle the request.');
    }
}

async function deleteRequest(requestId) {
    const response = await fetch(`/meatup/delete/${requestId}/`, {
        method: 'POST',
        headers: { 'X-CSRFToken': '{{ csrf_token }}' },
    });

    if (response.ok) {
        document.getElementById(`req-${requestId}`).remove();
        alert('Request deleted successfully!');
    } else {
        alert('Failed to delete the request.');
    }
}
</script>
{% endblock content %} -->